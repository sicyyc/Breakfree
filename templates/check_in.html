{% extends "base.html" %}

{% block title %}Daily Activities & Interventions - BreakFree{% endblock %}

{% block page_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/check_in.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/calendar.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/modals.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/calendar-enhancements.css') }}">
<style>
    .calendar-container {
        background: transparent;
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 24px;
        width: 100%;
        max-width: 100%;
    }

    .calendar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
    }

    .calendar-title {
        font-size: 24px;
        font-weight: 600;
        color: #2c3e50;
        margin: 0;
    }

    .calendar-subtitle {
        font-size: 14px;
        color: #666;
        margin: 4px 0 0 0;
    }

    .calendar-nav {
        display: flex;
        gap: 12px;
        align-items: center;
    }

    .nav-btn {
        background: #3498db;
        color: white;
        border: none;
        border-radius: 8px;
        padding: 8px 16px;
        cursor: pointer;
        font-size: 14px;
        transition: background 0.3s;
    }

    .nav-btn:hover {
        background: #2980b9;
    }

    .current-month {
        font-size: 18px;
        font-weight: 500;
        color: #2c3e50;
        min-width: 120px;
        text-align: center;
    }

    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 1px;
        background: #ecf0f1;
        border-radius: 8px;
        overflow: hidden;
        width: 100%;
    }

    .calendar-weekday {
        background: #34495e;
        color: white;
        padding: 12px 8px;
        text-align: center;
        font-weight: 500;
        font-size: 14px;
    }

    .calendar-day {
        background: white;
        padding: 12px 8px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
        min-height: 60px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        position: relative;
        writing-mode: horizontal-tb;
        text-orientation: mixed;
    }

    .calendar-day:hover {
        background: #f8f9fa;
        transform: scale(1.02);
    }

    /* Ensure calendar days are properly sized */
    .calendar-day {
        aspect-ratio: 1;
        min-width: 0;
        min-height: 60px;
    }

    .calendar-day.other-month {
        color: #bdc3c7;
        background: #f8f9fa;
    }

    .calendar-day.today {
        background: #3498db;
        color: white;
        font-weight: 600;
    }

    .calendar-day.has-activity {
        background: #e8f5e8;
        border: 2px solid #27ae60;
    }

    .calendar-day.has-intervention {
        background: #fff3cd;
        border: 2px solid #ffc107;
    }

    .day-number {
        font-size: 16px;
        font-weight: 500;
    }

    .day-indicator {
        position: absolute;
        top: 4px;
        right: 4px;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #e74c3c;
    }

    .day-indicator.activity {
        background: #27ae60;
    }

    .day-indicator.intervention {
        background: #f39c12;
    }

    .activity-modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(2px);
    }

    .activity-modal-content {
        background-color: white;
        margin: 8% auto;
        padding: 0;
        border-radius: 8px;
        width: 90%;
        max-width: 600px;
        max-height: 70vh;
        overflow-y: auto;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        border: 1px solid #e0e0e0;
    }

    .activity-header {
        background: #f8f9fa;
        color: #333;
        padding: 16px 20px;
        border-radius: 8px 8px 0 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid #e0e0e0;
    }

    .activity-title {
        font-size: 18px;
        font-weight: 600;
        color: #2c3e50;
    }

    .activity-date {
        font-size: 14px;
        color: #666;
    }

    .close-activity {
        background: none;
        border: none;
        color: #666;
        font-size: 20px;
        cursor: pointer;
        padding: 0;
        width: 28px;
        height: 28px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 4px;
        transition: all 0.3s;
    }

    .close-activity:hover {
        background: #e0e0e0;
        color: #333;
    }

    .activity-body {
        padding: 20px;
    }

    .schedule-table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        border-radius: 6px;
        overflow: hidden;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        border: 1px solid #e0e0e0;
    }

    .schedule-table th {
        background: #f8f9fa;
        color: #333;
        padding: 10px 8px;
        text-align: center;
        font-weight: 600;
        font-size: 13px;
        border-bottom: 1px solid #e0e0e0;
    }

    .schedule-table td {
        padding: 10px 8px;
        text-align: center;
        border-bottom: 1px solid #f0f0f0;
        font-size: 12px;
        vertical-align: middle;
    }

    .time-slot {
        font-weight: 600;
        color: #2c3e50;
        background: #f8f9fa;
    }

    .activity-cell {
        background: #e8f5e8;
        color: #27ae60;
        font-weight: 500;
    }

    .intervention-cell {
        background: #fff3cd;
        color: #856404;
        font-weight: 500;
    }

    .meal-cell {
        background: #ffeaa7;
        color: #d63031;
        font-weight: 500;
    }

    .view-toggle {
        display: flex;
        gap: 8px;
    }

    .view-btn {
        background: #f8f9fa;
        border: 1px solid #e0e0e0;
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s;
        color: #666;
    }

    .view-btn.active {
        background: #4682A9;
        color: white;
        border-color: #4682A9;
    }

    .view-btn:hover {
        background: #4682A9;
        color: white;
        border-color: #4682A9;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .calendar-container {
            max-width: 100%;
            padding: 16px;
        }
        
        .calendar-day {
            min-height: 50px;
            padding: 8px 4px;
        }
        
        .day-number {
            font-size: 14px;
        }
        
        .calendar-weekday {
            font-size: 12px;
            padding: 8px 4px;
        }
        
        .activity-modal-content {
            width: 95%;
            margin: 5% auto;
        }
    }

    /* Calendar Legend Styles */
    .calendar-legend {
        display: flex;
        gap: 16px;
        margin-top: 16px;
        justify-content: center;
        flex-wrap: wrap;
    }

    .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        color: #2c3e50;
    }

    .legend-color {
        width: 16px;
        height: 16px;
        border-radius: 4px;
        border: 1px solid #ddd;
    }

    .legend-color.regular {
        background: #e8f5e8;
        border-color: #27ae60;
    }

    .legend-color.intervention {
        background: #fff3cd;
        border-color: #ffc107;
    }

    .legend-color.today {
        background: #3498db;
        border-color: #2980b9;
    }
</style>
{% endblock %}

{% block content %}
<div class="main-header">
    <div>
        <h1>Daily Activities & Interventions</h1>
        <p>Comprehensive daily schedules and therapeutic intervention tracking</p>
    </div>
    <div class="view-toggle">
        <button class="view-btn active" data-view="activities">
            <i class="fas fa-calendar-alt"></i>
            Daily Activities
        </button>
        <button class="view-btn" data-view="interventions">
            <i class="fas fa-stethoscope"></i>
            Interventions
        </button>
    </div>
</div>

    <div class="calendar-container">
        <div class="calendar-header">
            <div class="calendar-title-section">
                <h2 class="calendar-title">Activity Calendar</h2>
                <p class="calendar-subtitle">Click any date to view daily activities and interventions</p>
            </div>
            <div class="calendar-nav">
                <button class="nav-btn" id="prevMonth">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <div class="current-month" id="currentMonth">June 2025</div>
                <button class="nav-btn" id="nextMonth">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>

            <div class="calendar-grid">
            <div class="calendar-weekday">Sun</div>
            <div class="calendar-weekday">Mon</div>
            <div class="calendar-weekday">Tue</div>
            <div class="calendar-weekday">Wed</div>
            <div class="calendar-weekday">Thu</div>
            <div class="calendar-weekday">Fri</div>
            <div class="calendar-weekday">Sat</div>
            <!-- Calendar days will be populated by JavaScript directly here -->
        </div>
        
        <div class="calendar-legend">
            <div class="legend-item">
                <div class="legend-color regular"></div>
                <span>Regular Activities</span>
            </div>
            <div class="legend-item">
                <div class="legend-color intervention"></div>
                <span>Interventions</span>
            </div>
            <div class="legend-item">
                <div class="legend-color today"></div>
                <span>Today</span>
            </div>
        </div>
</div>

<!-- Activity Modal -->
<div id="activityModal" class="activity-modal">
    <div class="activity-modal-content">
        <div class="activity-header">
            <div>
                <div class="activity-title" id="modalTitle">Daily Activities</div>
                <div class="activity-date" id="modalDate">June 15, 2025</div>
            </div>
            <button class="close-activity" id="closeActivity">&times;</button>
        </div>
        <div class="activity-body">
            <h3><i class="fas fa-clock"></i> Daily Schedule</h3>
            <div class="schedule-summary">
                <div class="summary-item">
                    <i class="fas fa-tasks"></i>
                    <span id="totalActivities">0</span>
                    <label>Total Activities</label>
                </div>
                <div class="summary-item">
                    <i class="fas fa-stethoscope"></i>
                    <span id="interventionCount">0</span>
                    <label>Interventions</label>
                </div>
                <div class="summary-item">
                    <i class="fas fa-utensils"></i>
                    <span id="mealCount">0</span>
                    <label>Meal Times</label>
                </div>
            </div>
            <table class="schedule-table" id="scheduleTable">
                <thead>
                    <tr>
                        <th>Time</th>
                        <th>Activity</th>
                    </tr>
                </thead>
                <tbody id="scheduleBody">
                    <!-- Schedule will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/check_in.js') }}"></script>
<script>
// Daily Activities Data
const dailyActivities = {
    "5:00AM - 5:15AM": {
        "Monday": "", "Tuesday": "", "Wednesday": "", "Thursday": "WAKING-UP", "Friday": "", "Saturday": "", "Sunday": ""
    },
    "5:15AM - 5:30AM": {
        "Monday": "", "Tuesday": "", "Wednesday": "", "Thursday": "BREAKFAST PREPARATION / EXERCISE", "Friday": "", "Saturday": "", "Sunday": ""
    },
    "5:30AM - 6:00AM": {
        "Monday": "", "Tuesday": "", "Wednesday": "", "Thursday": "BREAKFAST", "Friday": "", "Saturday": "", "Sunday": ""
    },
    "6:00AM - 6:30AM": {
        "Monday": "", "Tuesday": "", "Wednesday": "", "Thursday": "WASHING DISHES & CLEANING OF DINING AREA", "Friday": "", "Saturday": "", "Sunday": ""
    },
    "6:30AM - 7:30AM": {
        "Monday": "", "Tuesday": "", "Wednesday": "", "Thursday": "BATHING AND LAUNDRY TIME / CLEANING OF SURROUNDINGS", "Friday": "", "Saturday": "", "Sunday": ""
    },
    "7:30AM - 8:30AM": {
        "Monday": "", "Tuesday": "", "Wednesday": "", "Thursday": "FLAG CEREMONY (MONDAY) / MORNING PRAYER, RECITAL OF THE HOLY ROSARY", "Friday": "", "Saturday": "", "Sunday": ""
    },
    "8:30AM - 9:00AM": {
        "Monday": "MORNING SESSION", "Tuesday": "MORNING SESSION", "Wednesday": "MORNING SESSION", "Thursday": "MORNING SESSION", "Friday": "MORNING SESSION", "Saturday": "MORNING SESSION", "Sunday": "MORNING SESSION"
    },
    "9:00AM - 9:30AM": {
        "Monday": "GARDENING", "Tuesday": "HEALTH & NUTRITION EDUCATION", "Wednesday": "SKILLS TRAINING / LECTURES/GARDENING", "Thursday": "PROJECT MAKING", "Friday": "PROJECT MAKING", "Saturday": "VISITING DAYS (9:00AM TO 3:00PM) RECREATIONAL ACTIVITY (INDOOR) Guitar Playing, Board Games, Movie Viewing", "Sunday": "GENERAL CLEANING"
    },
    "9:30AM - 10:00AM": {
        "Monday": "GARDENING", "Tuesday": "CASECON/ GARDENING", "Wednesday": "SKILLS TRAINING / LECTURES/GARDENING", "Thursday": "PROJECT MAKING", "Friday": "PROJECT MAKING", "Saturday": "", "Sunday": "GENERAL CLEANING"
    },
    "10:00AM - 10:30AM": {
        "Monday": "GARDENING", "Tuesday": "CASECON/ GARDENING", "Wednesday": "SKILLS TRAINING / LECTURES/GARDENING", "Thursday": "PROJECT MAKING", "Friday": "PROJECT MAKING", "Saturday": "", "Sunday": "GENERAL CLEANING"
    },
    "10:30AM - 11:00AM": {
        "Monday": "LUNCH PREPARATION", "Tuesday": "LUNCH PREPARATION", "Wednesday": "LUNCH PREPARATION", "Thursday": "LUNCH PREPARATION", "Friday": "LUNCH PREPARATION", "Saturday": "", "Sunday": "LUNCH PREPARATION"
    },
    "11:00AM - 11:30AM": {
        "Monday": "LUNCH PREPARATION", "Tuesday": "LUNCH PREPARATION", "Wednesday": "LUNCH PREPARATION", "Thursday": "LUNCH PREPARATION", "Friday": "LUNCH PREPARATION", "Saturday": "", "Sunday": "LUNCH PREPARATION"
    },
    "11:30AM - 12:00NN": {
        "Monday": "LUNCH TIME", "Tuesday": "LUNCH TIME", "Wednesday": "LUNCH TIME", "Thursday": "LUNCH TIME", "Friday": "LUNCH TIME", "Saturday": "", "Sunday": "LUNCH TIME"
    },
    "12:00NN - 12:30PM": {
        "Monday": "LUNCH TIME", "Tuesday": "LUNCH TIME", "Wednesday": "LUNCH TIME", "Thursday": "LUNCH TIME", "Friday": "LUNCH TIME", "Saturday": "", "Sunday": "LUNCH TIME"
    },
    "12:30PM - 1:00PM": {
        "Monday": "TV VIEWING/USE OF PRAYER ROOM/NAP TIME", "Tuesday": "TV VIEWING/USE OF PRAYER ROOM/NAP TIME", "Wednesday": "TV VIEWING/USE OF PRAYER ROOM/NAP TIME", "Thursday": "TV VIEWING / NAP TIME", "Friday": "TV VIEWING/USE OF PRAYER ROOM/NAP TIME", "Saturday": "", "Sunday": "TV VIEWING / NAP TIME"
    },
    "1:00PM - 1:30PM": {
        "Monday": "TV VIEWING/USE OF PRAYER ROOM/NAP TIME", "Tuesday": "TV VIEWING/USE OF PRAYER ROOM/NAP TIME", "Wednesday": "TV VIEWING/USE OF PRAYER ROOM/NAP TIME", "Thursday": "TV VIEWING / NAP TIME", "Friday": "TV VIEWING/USE OF PRAYER ROOM/NAP TIME", "Saturday": "", "Sunday": "TV VIEWING / NAP TIME"
    },
    "1:30PM - 2:00PM": {
        "Monday": "TV VIEWING/USE OF PRAYER ROOM/NAP TIME", "Tuesday": "TV VIEWING/USE OF PRAYER ROOM/NAP TIME", "Wednesday": "TV VIEWING/USE OF PRAYER ROOM/NAP TIME", "Thursday": "TV VIEWING / NAP TIME", "Friday": "TV VIEWING/USE OF PRAYER ROOM/NAP TIME", "Saturday": "", "Sunday": "TV VIEWING / NAP TIME"
    },
    "2:00PM - 2:30PM": {
        "Monday": "PROJECT MAKING", "Tuesday": "JOURNAL ACTIVITY/ PROJECT MAKING", "Wednesday": "ALS SESSION / PROJECT MAKING", "Thursday": "PROJECT MAKING", "Friday": "GROUP DYNAMICS/ MUSIC THERAPY", "Saturday": "", "Sunday": "PROJECT MAKING"
    },
    "2:30PM - 3:00PM": {
        "Monday": "PROJECT MAKING", "Tuesday": "JOURNAL ACTIVITY/ PROJECT MAKING", "Wednesday": "ALS SESSION / PROJECT MAKING", "Thursday": "PROJECT MAKING", "Friday": "GROUP DYNAMICS/ MUSIC THERAPY", "Saturday": "", "Sunday": "PROJECT MAKING"
    },
    "3:00PM - 3:30PM": {
        "Monday": "SNACK TIME", "Tuesday": "SNACK TIME", "Wednesday": "SNACK TIME", "Thursday": "SNACK TIME", "Friday": "SNACK TIME", "Saturday": "SNACK TIME", "Sunday": "SNACK TIME"
    },
    "3:30PM - 4:00PM": {
        "Monday": "SPORTS ACTIVITIES", "Tuesday": "FITNESS TIME", "Wednesday": "SPORTS ACTIVITIES", "Thursday": "GARDENING", "Friday": "SPORTS ACTIVITIES", "Saturday": "GARDENING", "Sunday": "GARDENING"
    },
    "4:00PM - 4:30PM": {
        "Monday": "SPORTS ACTIVITIES", "Tuesday": "FITNESS TIME", "Wednesday": "SPORTS ACTIVITIES", "Thursday": "GARDENING", "Friday": "SPORTS ACTIVITIES", "Saturday": "GARDENING", "Sunday": "GARDENING"
    },
    "4:30PM - 5:00PM": {
        "Monday": "READING TIME / JOURNAL WRITING", "Tuesday": "READING TIME / JOURNAL WRITING", "Wednesday": "READING TIME / JOURNAL WRITING", "Thursday": "READING TIME / JOURNAL WRITING", "Friday": "READING TIME / JOURNAL WRITING", "Saturday": "READING TIME / JOURNAL WRITING", "Sunday": "PROJECT MAKING / JOURNAL WRITING"
    },
    "5:00PM - 5:30PM": {
        "Monday": "READING TIME / JOURNAL WRITING", "Tuesday": "READING TIME / JOURNAL WRITING", "Wednesday": "READING TIME / JOURNAL WRITING", "Thursday": "READING TIME / JOURNAL WRITING", "Friday": "READING TIME / JOURNAL WRITING", "Saturday": "READING TIME / JOURNAL WRITING", "Sunday": "PROJECT MAKING / JOURNAL WRITING"
    },
    "5:30PM - 6:00PM": {
        "Monday": "READING TIME / JOURNAL WRITING", "Tuesday": "READING TIME / JOURNAL WRITING", "Wednesday": "READING TIME / JOURNAL WRITING", "Thursday": "READING TIME / JOURNAL WRITING", "Friday": "READING TIME / JOURNAL WRITING", "Saturday": "READING TIME / JOURNAL WRITING", "Sunday": "PROJECT MAKING / JOURNAL WRITING"
    },
    "6:00PM - 6:30PM": {
        "Monday": "FOOD PREPARATION", "Tuesday": "FOOD PREPARATION", "Wednesday": "FOOD PREPARATION", "Thursday": "FOOD PREPARATION", "Friday": "FOOD PREPARATION", "Saturday": "FOOD PREPARATION", "Sunday": "FOOD PREPARATION"
    },
    "6:30PM - 7:00PM": {
        "Monday": "HYGIENE TIME", "Tuesday": "HYGIENE TIME", "Wednesday": "HYGIENE TIME", "Thursday": "HYGIENE TIME", "Friday": "HYGIENE TIME", "Saturday": "HYGIENE TIME", "Sunday": "HYGIENE TIME"
    },
    "7:00PM - 7:30PM": {
        "Monday": "ANGELUS", "Tuesday": "ANGELUS", "Wednesday": "ANGELUS", "Thursday": "ANGELUS", "Friday": "ANGELUS", "Saturday": "ANGELUS", "Sunday": "ANGELUS"
    },
    "7:30PM - 8:00PM": {
        "Monday": "DINNER", "Tuesday": "DINNER", "Wednesday": "DINNER", "Thursday": "DINNER", "Friday": "DINNER", "Saturday": "DINNER", "Sunday": "DINNER"
    },
    "8:00PM - 8:30PM": {
        "Monday": "CLEANING OF DINING AREA / TV VIEWING", "Tuesday": "CLEANING OF DINING AREA / TV VIEWING", "Wednesday": "CLEANING OF DINING AREA / TV VIEWING", "Thursday": "CLEANING OF DINING AREA / TV VIEWING", "Friday": "CLEANING OF DINING AREA / TV VIEWING", "Saturday": "CLEANING OF DINING AREA / TV VIEWING", "Sunday": "CLEANING OF DINING AREA / TV VIEWING"
    },
    "8:30PM - 9:00PM": {
        "Monday": "CLEANING OF DINING AREA / TV VIEWING", "Tuesday": "CLEANING OF DINING AREA / TV VIEWING", "Wednesday": "CLEANING OF DINING AREA / TV VIEWING", "Thursday": "CLEANING OF DINING AREA / TV VIEWING", "Friday": "CLEANING OF DINING AREA / TV VIEWING", "Saturday": "CLEANING OF DINING AREA / TV VIEWING", "Sunday": "CLEANING OF DINING AREA / TV VIEWING"
    },
    "9:00PM": {
        "Monday": "LIGHTS OFF", "Tuesday": "LIGHTS OFF", "Wednesday": "LIGHTS OFF", "Thursday": "LIGHTS OFF", "Friday": "LIGHTS OFF", "Saturday": "LIGHTS OFF", "Sunday": "LIGHTS OFF"
    }
};

let currentDate = new Date();
let selectedDate = new Date();

// Initialize calendar
function initCalendar() {
    console.log('Initializing calendar...');
    updateCalendar();
    setupEventListeners();
    console.log('Calendar initialized successfully');
}

// Update calendar display
function updateCalendar() {
    console.log('Updating calendar...');
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();
    
    document.getElementById('currentMonth').textContent = 
        new Date(year, month).toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
    
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const startDate = new Date(firstDay);
    startDate.setDate(startDate.getDate() - firstDay.getDay());
    
    const calendarGrid = document.querySelector('.calendar-grid');
    
    // Clear existing content but preserve weekday headers
    const weekdayHeaders = calendarGrid.querySelectorAll('.calendar-weekday');
    calendarGrid.innerHTML = '';
    
    // Restore weekday headers
    weekdayHeaders.forEach(header => {
        calendarGrid.appendChild(header);
    });
    
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    
    for (let i = 0; i < 42; i++) {
        const date = new Date(startDate);
        date.setDate(startDate.getDate() + i);
        
        const dayElement = document.createElement('div');
        dayElement.className = 'calendar-day';
        dayElement.textContent = date.getDate();
        
        // Check if it's current month
        if (date.getMonth() !== month) {
            dayElement.classList.add('other-month');
        }
        
        // Check if it's today
        if (date.getTime() === today.getTime()) {
            dayElement.classList.add('today');
        }
        
        // Add click event
        dayElement.addEventListener('click', () => {
            selectedDate = date;
            const dayOfWeek = date.toLocaleDateString('en-US', { weekday: 'long' });
            showActivityModal(dayOfWeek);
        });
        
        calendarGrid.appendChild(dayElement);
    }
    console.log('Calendar updated successfully with', calendarGrid.children.length, 'elements');
}

// Show activity modal
function showActivityModal(dayOfWeek) {
    const modal = document.getElementById('activityModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalDate = document.getElementById('modalDate');
    
    modalTitle.textContent = `${dayOfWeek} Activities`;
    modalDate.textContent = selectedDate.toLocaleDateString('en-US', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
    });
    
    updateScheduleTable(dayOfWeek);
    modal.style.display = 'block';
}

// Update schedule table
function updateScheduleTable(dayOfWeek) {
    const tbody = document.getElementById('scheduleBody');
    tbody.innerHTML = '';
    
    let totalActivities = 0;
    let interventionCount = 0;
    let mealCount = 0;
    
    Object.entries(dailyActivities).forEach(([time, activities]) => {
        const activity = activities[dayOfWeek] || '';
        if (activity) {
            totalActivities++;
            
            const row = document.createElement('tr');
            
            const timeCell = document.createElement('td');
            timeCell.className = 'time-slot';
            timeCell.textContent = time;
            row.appendChild(timeCell);
            
            const activityCell = document.createElement('td');
            if (activity.includes('GARDENING') || activity.includes('PROJECT MAKING') || activity.includes('SKILLS TRAINING') || activity.includes('HEALTH & NUTRITION') || activity.includes('ALS SESSION') || activity.includes('GROUP DYNAMICS') || activity.includes('JOURNAL ACTIVITY')) {
                activityCell.className = 'intervention-cell';
                interventionCount++;
            } else if (activity.includes('LUNCH') || activity.includes('BREAKFAST') || activity.includes('DINNER') || activity.includes('SNACK')) {
                activityCell.className = 'meal-cell';
                mealCount++;
            } else {
                activityCell.className = 'activity-cell';
            }
            activityCell.textContent = activity;
            row.appendChild(activityCell);
            
            tbody.appendChild(row);
        }
    });
    
    // Update summary statistics
    document.getElementById('totalActivities').textContent = totalActivities;
    document.getElementById('interventionCount').textContent = interventionCount;
    document.getElementById('mealCount').textContent = mealCount;
}

// Setup event listeners
function setupEventListeners() {
    // Navigation buttons
    document.getElementById('prevMonth').addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() - 1);
        updateCalendar();
    });
    
    document.getElementById('nextMonth').addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() + 1);
        updateCalendar();
    });
    
    // Close modal
    document.getElementById('closeActivity').addEventListener('click', () => {
        document.getElementById('activityModal').style.display = 'none';
    });
    
    // Close modal when clicking outside
    window.addEventListener('click', (event) => {
        const modal = document.getElementById('activityModal');
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    });
}

// Initialize when DOM is loaded
document.addEventListener('DOMContentLoaded', initCalendar);
</script>
{% endblock %} 