{% extends "base.html" %}

{% block title %}Weekly Activity Schedule - BreakFree{% endblock %}

{% block page_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/check_in.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/modals.css') }}">
<style>
    .weekly-schedule-container {
        background: white;
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 24px;
        width: 100%;
        max-width: 100%;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .schedule-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        flex-wrap: wrap;
        gap: 16px;
    }

    .header-title {
        font-size: 28px;
        font-weight: 600;
        color: #2c3e50;
        margin: 0;
    }

    .header-subtitle {
        font-size: 16px;
        color: #666;
        margin: 4px 0 0 0;
    }

    .header-actions {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
    }

    .action-btn {
        background: #3498db;
        color: white;
        border: none;
        border-radius: 8px;
        padding: 10px 20px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .action-btn:hover {
        background: #2980b9;
        transform: translateY(-1px);
    }

    .action-btn.secondary {
        background: #95a5a6;
    }

    .action-btn.secondary:hover {
        background: #7f8c8d;
    }

    .action-btn.danger {
        background: #e74c3c;
    }

    .action-btn.danger:hover {
        background: #c0392b;
    }

    .action-btn.success {
        background: #27ae60;
    }

    .action-btn.success:hover {
        background: #229954;
    }

    .weekly-table-container {
        overflow-x: auto;
        border-radius: 8px;
        border: 1px solid #e0e0e0;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .weekly-table {
        width: 100%;
        min-width: 1200px;
        border-collapse: collapse;
        background: white;
    }

    .weekly-table th {
        background: #34495e;
        color: white;
        padding: 16px 12px;
        text-align: center;
        font-weight: 600;
        font-size: 14px;
        border-right: 1px solid #2c3e50;
        position: sticky;
        top: 0;
        z-index: 10;
    }

    .weekly-table th:first-child {
        background: #2c3e50;
        min-width: 140px;
    }

    .weekly-table td {
        padding: 12px 8px;
        text-align: center;
        border: 1px solid #e0e0e0;
        font-size: 12px;
        vertical-align: middle;
        min-height: 60px;
        cursor: pointer;
        transition: all 0.2s;
        position: relative;
    }

    .weekly-table td:hover {
        background: #f8f9fa;
        transform: scale(1.02);
    }

    .weekly-table td.editing {
        background: #fff3cd;
        border: 2px solid #f39c12;
        padding: 8px;
    }

    .time-slot {
        background: #f8f9fa;
        font-weight: 600;
        color: #2c3e50;
        text-align: right;
        padding-right: 16px;
        cursor: default;
        min-width: 140px;
    }

    .time-slot:hover {
        background: #f8f9fa;
        transform: none;
    }

    .activity-cell {
        background: #e8f5e8;
        color: #27ae60;
        font-weight: 500;
        min-height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        word-wrap: break-word;
        line-height: 1.3;
    }

    .activity-cell.morning {
        background: #e3f2fd;
        color: #1976d2;
    }

    .activity-cell.gardening {
        background: #e8f5e8;
        color: #27ae60;
    }

    .activity-cell.meal {
        background: #fff3e0;
        color: #f57c00;
    }

    .activity-cell.intervention {
        background: #f3e5f5;
        color: #7b1fa2;
    }

    .activity-cell.leisure {
        background: #e0f2f1;
        color: #00796b;
    }

    .activity-cell.cleaning {
        background: #fce4ec;
        color: #c2185b;
    }

    .activity-cell.prayer {
        background: #f1f8e9;
        color: #388e3c;
    }

    .edit-input {
        width: 100%;
        border: none;
        background: transparent;
        font-size: 12px;
        text-align: center;
        outline: none;
        resize: none;
        font-family: inherit;
        color: inherit;
    }

    .edit-input:focus {
        background: white;
        border: 1px solid #3498db;
        border-radius: 4px;
    }

    .bulk-actions {
        display: flex;
        gap: 12px;
        margin: 20px 0;
        padding: 16px;
        background: #f8f9fa;
        border-radius: 8px;
        border: 1px solid #e0e0e0;
        flex-wrap: wrap;
    }

    .bulk-action-group {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .bulk-select {
        padding: 6px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
    }

    .activity-templates {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        margin: 16px 0;
    }

    .template-btn {
        background: #ecf0f1;
        border: 1px solid #bdc3c7;
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 12px;
        transition: all 0.2s;
        color: #2c3e50;
    }

    .template-btn:hover {
        background: #d5dbdb;
        border-color: #95a5a6;
    }

    .legend-section {
        margin-top: 24px;
        padding: 16px;
        background: #f8f9fa;
        border-radius: 8px;
        border: 1px solid #e0e0e0;
    }

    .legend-title {
        font-size: 16px;
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 12px;
    }

    .legend-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 12px;
    }

    .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        color: #2c3e50;
    }

    .legend-color {
        width: 16px;
        height: 16px;
        border-radius: 4px;
        border: 1px solid #ddd;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .weekly-schedule-container {
            padding: 16px;
        }
        
        .schedule-header {
            flex-direction: column;
            align-items: flex-start;
        }
        
        .header-actions {
            width: 100%;
            justify-content: center;
        }
        
        .weekly-table-container {
            margin: 0 -16px;
        }
        
        .bulk-actions {
            flex-direction: column;
        }
        
        .action-btn {
            width: 100%;
            justify-content: center;
        }
    }

    /* Print Styles */
    @media print {
        .header-actions,
        .bulk-actions,
        .legend-section {
            display: none;
        }
        
        .weekly-table {
            min-width: auto;
            width: 100%;
        }
        
        .weekly-table th,
        .weekly-table td {
            border: 1px solid #000;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="weekly-schedule-container">
    <div class="schedule-header">
        <div>
            <h1 class="header-title">Weekly Activity Schedule</h1>
            <p class="header-subtitle">Edit activities and times for all days of the week</p>
        </div>
        <div class="header-actions">
            <button class="action-btn success" id="saveAllBtn">
                <i class="fas fa-save"></i>
                Save All Changes
            </button>
            <button class="action-btn secondary" id="resetWeekBtn">
                <i class="fas fa-undo"></i>
                Reset Week
            </button>
            <button class="action-btn" id="editModeBtn">
                <i class="fas fa-edit"></i>
                Edit Mode
            </button>
            <button class="action-btn secondary" id="printBtn">
                <i class="fas fa-print"></i>
                Print
            </button>
        </div>
    </div>

    <div class="bulk-actions">
        <div class="bulk-action-group">
            <label for="bulkDay">Copy to Day:</label>
            <select id="bulkDay" class="bulk-select">
                <option value="">Select Day</option>
                <option value="sunday">Sunday</option>
                <option value="monday">Monday</option>
                <option value="tuesday">Tuesday</option>
                <option value="wednesday">Wednesday</option>
                <option value="thursday">Thursday</option>
                <option value="friday">Friday</option>
                <option value="saturday">Saturday</option>
            </select>
        </div>
        <div class="bulk-action-group">
            <label for="bulkActivity">Activity:</label>
            <select id="bulkActivity" class="bulk-select">
                <option value="">Select Activity</option>
                <option value="MORNING SESSION">Morning Session</option>
                <option value="GARDENING">Gardening</option>
                <option value="LUNCH PREPARATION">Lunch Preparation</option>
                <option value="LUNCH TIME">Lunch Time</option>
                <option value="PROJECT MAKING">Project Making</option>
                <option value="SPORTS ACTIVITIES">Sports Activities</option>
                <option value="READING TIME">Reading Time</option>
                <option value="DINNER">Dinner</option>
                <option value="CLEANING">Cleaning</option>
            </select>
        </div>
        <button class="action-btn secondary" id="applyBulkBtn">
            <i class="fas fa-copy"></i>
            Apply to Selected Day
        </button>
        <button class="action-btn danger" id="clearDayBtn">
            <i class="fas fa-trash"></i>
            Clear Selected Day
        </button>
    </div>

    <div class="activity-templates">
        <span>Quick Templates:</span>
        <button class="template-btn" data-activity="MORNING SESSION">Morning Session</button>
        <button class="template-btn" data-activity="GARDENING">Gardening</button>
        <button class="template-btn" data-activity="LUNCH PREPARATION">Lunch Prep</button>
        <button class="template-btn" data-activity="PROJECT MAKING">Project Making</button>
        <button class="template-btn" data-activity="SPORTS ACTIVITIES">Sports</button>
        <button class="template-btn" data-activity="READING TIME">Reading</button>
        <button class="template-btn" data-activity="DINNER">Dinner</button>
        <button class="template-btn" data-activity="CLEANING">Cleaning</button>
    </div>

    <div class="weekly-table-container">
        <table class="weekly-table" id="weeklyTable">
            <thead>
                <tr>
                    <th>Time Slots</th>
                    <th>Sunday</th>
                    <th>Monday</th>
                    <th>Tuesday</th>
                    <th>Wednesday</th>
                    <th>Thursday</th>
                    <th>Friday</th>
                    <th>Saturday</th>
                </tr>
            </thead>
            <tbody id="weeklyTableBody">
                <!-- Table rows will be populated by JavaScript -->
            </tbody>
        </table>
    </div>

    <div class="legend-section">
        <h3 class="legend-title">Activity Type Legend</h3>
        <div class="legend-grid">
            <div class="legend-item">
                <div class="legend-color" style="background: #e3f2fd; border-color: #1976d2;"></div>
                <span>Morning Activities</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #e8f5e8; border-color: #27ae60;"></div>
                <span>Gardening & Outdoor</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #fff3e0; border-color: #f57c00;"></div>
                <span>Meal Times</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #f3e5f5; border-color: #7b1fa2;"></div>
                <span>Therapeutic Interventions</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #e0f2f1; border-color: #00796b;"></div>
                <span>Leisure & Recreation</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #fce4ec; border-color: #c2185b;"></div>
                <span>Cleaning & Maintenance</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #f1f8e9; border-color: #388e3c;"></div>
                <span>Prayer & Spiritual</span>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Weekly Schedule Data Structure
const weeklySchedule = {
    sunday: {},
    monday: {},
    tuesday: {},
    wednesday: {},
    thursday: {},
    friday: {},
    saturday: {}
};

// Time slots for the weekly schedule
const timeSlots = [
    "8:30AM - 9:00AM",
    "9:00AM - 9:30AM",
    "9:30AM - 10:00AM",
    "10:00AM - 10:30AM",
    "10:30AM - 11:00AM",
    "11:00AM - 11:30AM",
    "11:30AM - 12:00NN",
    "12:00NN - 12:30PM",
    "12:30PM - 1:00PM",
    "1:00PM - 1:30PM"
];

// Default activities for each day (based on the paper form)
const defaultActivities = {
    sunday: {
        "8:30AM - 9:00AM": "MORNING SESSION",
        "9:00AM - 9:30AM": "GENERAL CLEANING",
        "9:30AM - 10:00AM": "GENERAL CLEANING",
        "10:00AM - 10:30AM": "GENERAL CLEANING",
        "10:30AM - 11:00AM": "LUNCH PREPARATION",
        "11:00AM - 11:30AM": "LUNCH PREPARATION",
        "11:30AM - 12:00NN": "LUNCH TIME",
        "12:00NN - 12:30PM": "LUNCH TIME",
        "12:30PM - 1:00PM": "TV VIEWING / NAP TIME",
        "1:00PM - 1:30PM": "TV VIEWING / NAP TIME"
    },
    monday: {
        "8:30AM - 9:00AM": "MORNING SESSION",
        "9:00AM - 9:30AM": "GARDENING",
        "9:30AM - 10:00AM": "GARDENING",
        "10:00AM - 10:30AM": "GARDENING",
        "10:30AM - 11:00AM": "LUNCH PREPARATION",
        "11:00AM - 11:30AM": "LUNCH PREPARATION",
        "11:30AM - 12:00NN": "LUNCH TIME",
        "12:00NN - 12:30PM": "LUNCH TIME",
        "12:30PM - 1:00PM": "TV VIEWING/USE OF PRAYER ROOM/NAP TIME",
        "1:00PM - 1:30PM": "TV VIEWING/USE OF PRAYER ROOM/NAP TIME"
    },
    tuesday: {
        "8:30AM - 9:00AM": "MORNING SESSION",
        "9:00AM - 9:30AM": "HEALTH & NUTRITION EDUCATION",
        "9:30AM - 10:00AM": "CASECON/ GARDENING",
        "10:00AM - 10:30AM": "CASECON/ GARDENING",
        "10:30AM - 11:00AM": "LUNCH PREPARATION",
        "11:00AM - 11:30AM": "LUNCH PREPARATION",
        "11:30AM - 12:00NN": "LUNCH TIME",
        "12:00NN - 12:30PM": "LUNCH TIME",
        "12:30PM - 1:00PM": "TV VIEWING/USE OF PRAYER ROOM/NAP TIME",
        "1:00PM - 1:30PM": "TV VIEWING/USE OF PRAYER ROOM/NAP TIME"
    },
    wednesday: {
        "8:30AM - 9:00AM": "MORNING SESSION",
        "9:00AM - 9:30AM": "SKILLS TRAINING / LECTURES/GARDENING",
        "9:30AM - 10:00AM": "SKILLS TRAINING / LECTURES/GARDENING",
        "10:00AM - 10:30AM": "SKILLS TRAINING / LECTURES/GARDENING",
        "10:30AM - 11:00AM": "LUNCH PREPARATION",
        "11:00AM - 11:30AM": "LUNCH PREPARATION",
        "11:30AM - 12:00NN": "LUNCH TIME",
        "12:00NN - 12:30PM": "LUNCH TIME",
        "12:30PM - 1:00PM": "TV VIEWING/USE OF PRAYER ROOM/NAP TIME",
        "1:00PM - 1:30PM": "TV VIEWING/USE OF PRAYER ROOM/NAP TIME"
    },
    thursday: {
        "8:30AM - 9:00AM": "MORNING SESSION",
        "9:00AM - 9:30AM": "PROJECT MAKING",
        "9:30AM - 10:00AM": "PROJECT MAKING",
        "10:00AM - 10:30AM": "PROJECT MAKING",
        "10:30AM - 11:00AM": "LUNCH PREPARATION",
        "11:00AM - 11:30AM": "LUNCH PREPARATION",
        "11:30AM - 12:00NN": "LUNCH TIME",
        "12:00NN - 12:30PM": "LUNCH TIME",
        "12:30PM - 1:00PM": "TV VIEWING / NAP TIME",
        "1:00PM - 1:30PM": "TV VIEWING / NAP TIME"
    },
    friday: {
        "8:30AM - 9:00AM": "MORNING SESSION",
        "9:00AM - 9:30AM": "PROJECT MAKING",
        "9:30AM - 10:00AM": "PROJECT MAKING",
        "10:00AM - 10:30AM": "PROJECT MAKING",
        "10:30AM - 11:00AM": "LUNCH PREPARATION",
        "11:00AM - 11:30AM": "LUNCH PREPARATION",
        "11:30AM - 12:00NN": "LUNCH TIME",
        "12:00NN - 12:30PM": "LUNCH TIME",
        "12:30PM - 1:00PM": "TV VIEWING/USE OF PRAYER ROOM/NAP TIME",
        "1:00PM - 1:30PM": "TV VIEWING/USE OF PRAYER ROOM/NAP TIME"
    },
    saturday: {
        "8:30AM - 9:00AM": "MORNING SESSION",
        "9:00AM - 9:30AM": "VISITING DAYS (9:00AM TO 3:00PM) RECREATIONAL ACTIVITY (INDOOR) Guitar Playing, Board Games, Movie Viewing",
        "9:30AM - 10:00AM": "",
        "10:00AM - 10:30AM": "",
        "10:30AM - 11:00AM": "",
        "11:00AM - 11:30AM": "",
        "11:30AM - 12:00NN": "",
        "12:00NN - 12:30PM": "",
        "12:30PM - 1:00PM": "",
        "1:00PM - 1:30PM": ""
    }
};

// Global variables
let isEditMode = false;
let currentEditingCell = null;

// Initialize weekly schedule
function initWeeklySchedule() {
    console.log('Initializing weekly schedule...');
    
    // Load saved data or use defaults
    loadScheduleData();
    
    // Build the weekly table
    buildWeeklyTable();
    
    // Setup event listeners
    setupEventListeners();
    
    console.log('Weekly schedule initialized successfully');
}

// Load schedule data from localStorage or use defaults
function loadScheduleData() {
    const savedData = localStorage.getItem('weeklySchedule');
    if (savedData) {
        try {
            Object.assign(weeklySchedule, JSON.parse(savedData));
        } catch (e) {
            console.error('Error loading saved data, using defaults:', e);
            Object.assign(weeklySchedule, defaultActivities);
        }
    } else {
        Object.assign(weeklySchedule, defaultActivities);
    }
}

// Save schedule data to localStorage
function saveScheduleData() {
    try {
        localStorage.setItem('weeklySchedule', JSON.stringify(weeklySchedule));
        console.log('Schedule data saved successfully');
        showNotification('Schedule saved successfully!', 'success');
    } catch (e) {
        console.error('Error saving data:', e);
        showNotification('Error saving schedule!', 'error');
    }
}

// Build the weekly table
function buildWeeklyTable() {
    const tbody = document.getElementById('weeklyTableBody');
    tbody.innerHTML = '';
    
    timeSlots.forEach(timeSlot => {
        const row = document.createElement('tr');
        
        // Time slot cell
        const timeCell = document.createElement('td');
        timeCell.className = 'time-slot';
        timeCell.textContent = timeSlot;
        row.appendChild(timeCell);
        
        // Activity cells for each day
        const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
        days.forEach(day => {
            const activityCell = document.createElement('td');
            const activity = weeklySchedule[day][timeSlot] || '';
            
            activityCell.className = 'activity-cell';
            activityCell.textContent = activity;
            activityCell.dataset.day = day;
            activityCell.dataset.time = timeSlot;
            
            // Add activity type classes for color coding
            addActivityTypeClass(activityCell, activity);
            
            // Add click event for editing
            activityCell.addEventListener('click', () => handleCellClick(activityCell));
            
            row.appendChild(activityCell);
        });
        
        tbody.appendChild(row);
    });
}

// Add activity type classes for color coding
function addActivityTypeClass(cell, activity) {
    if (!activity) return;
    
    if (activity.includes('MORNING SESSION')) {
        cell.classList.add('morning');
    } else if (activity.includes('GARDENING')) {
        cell.classList.add('gardening');
    } else if (activity.includes('LUNCH') || activity.includes('BREAKFAST') || activity.includes('DINNER') || activity.includes('SNACK')) {
        cell.classList.add('meal');
    } else if (activity.includes('PROJECT MAKING') || activity.includes('SKILLS TRAINING') || activity.includes('HEALTH & NUTRITION') || activity.includes('ALS SESSION')) {
        cell.classList.add('intervention');
    } else if (activity.includes('SPORTS') || activity.includes('RECREATIONAL') || activity.includes('TV VIEWING')) {
        cell.classList.add('leisure');
    } else if (activity.includes('CLEANING') || activity.includes('GENERAL CLEANING')) {
        cell.classList.add('cleaning');
    } else if (activity.includes('PRAYER') || activity.includes('ANGELUS')) {
        cell.classList.add('prayer');
    }
}

// Handle cell click for editing
function handleCellClick(cell) {
    if (!isEditMode) return;
    
    if (currentEditingCell) {
        finishEditing();
    }
    
    startEditing(cell);
}

// Start editing a cell
function startEditing(cell) {
    currentEditingCell = cell;
    cell.classList.add('editing');
    
    const input = document.createElement('textarea');
    input.className = 'edit-input';
    input.value = cell.textContent;
    input.rows = 3;
    
    // Clear cell content and add input
    cell.textContent = '';
    cell.appendChild(input);
    input.focus();
    
    // Handle input events
    input.addEventListener('blur', () => finishEditing());
    input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            finishEditing();
        }
    });
}

// Finish editing a cell
function finishEditing() {
    if (!currentEditingCell) return;
    
    const input = currentEditingCell.querySelector('.edit-input');
    if (input) {
        const newValue = input.value.trim();
        const day = currentEditingCell.dataset.day;
        const time = currentEditingCell.dataset.time;
        
        // Update data
        weeklySchedule[day][time] = newValue;
        
        // Update display
        currentEditingCell.textContent = newValue;
        currentEditingCell.classList.remove('editing');
        
        // Update color coding
        currentEditingCell.className = 'activity-cell';
        addActivityTypeClass(currentEditingCell, newValue);
        
        // Add back click event
        currentEditingCell.addEventListener('click', () => handleCellClick(currentEditingCell));
    }
    
    currentEditingCell = null;
}

// Toggle edit mode
function toggleEditMode() {
    isEditMode = !isEditMode;
    const editBtn = document.getElementById('editModeBtn');
    
    if (isEditMode) {
        editBtn.textContent = 'Exit Edit Mode';
        editBtn.classList.remove('action-btn');
        editBtn.classList.add('action-btn', 'danger');
        showNotification('Edit mode enabled. Click on any cell to edit.', 'info');
    } else {
        editBtn.textContent = 'Edit Mode';
        editBtn.classList.remove('action-btn', 'danger');
        editBtn.classList.add('action-btn');
        if (currentEditingCell) {
            finishEditing();
        }
        showNotification('Edit mode disabled.', 'info');
    }
}

// Apply bulk activity to selected day
function applyBulkActivity() {
    const selectedDay = document.getElementById('bulkDay').value;
    const selectedActivity = document.getElementById('bulkActivity').value;
    
    if (!selectedDay || !selectedActivity) {
        showNotification('Please select both a day and an activity.', 'warning');
        return;
    }
    
    // Apply activity to all time slots for the selected day
    timeSlots.forEach(timeSlot => {
        weeklySchedule[selectedDay][timeSlot] = selectedActivity;
    });
    
    // Rebuild table to show changes
    buildWeeklyTable();
    showNotification(`Applied "${selectedActivity}" to all time slots for ${selectedDay}.`, 'success');
}

// Clear selected day
function clearSelectedDay() {
    const selectedDay = document.getElementById('bulkDay').value;
    
    if (!selectedDay) {
        showNotification('Please select a day to clear.', 'warning');
        return;
    }
    
    if (confirm(`Are you sure you want to clear all activities for ${selectedDay}?`)) {
        timeSlots.forEach(timeSlot => {
            weeklySchedule[selectedDay][timeSlot] = '';
        });
        
        buildWeeklyTable();
        showNotification(`Cleared all activities for ${selectedDay}.`, 'success');
    }
}

// Reset week to defaults
function resetWeek() {
    if (confirm('Are you sure you want to reset the entire week to default activities? This cannot be undone.')) {
        Object.assign(weeklySchedule, defaultActivities);
        buildWeeklyTable();
        showNotification('Week reset to default activities.', 'success');
    }
}

// Save all changes
function saveAllChanges() {
    saveScheduleData();
}

// Print weekly schedule
function printSchedule() {
    window.print();
}

// Apply template activity
function applyTemplate(activity) {
    if (!isEditMode) {
        showNotification('Please enable edit mode first.', 'warning');
        return;
    }
    
    if (currentEditingCell) {
        const input = currentEditingCell.querySelector('.edit-input');
        if (input) {
            input.value = activity;
        }
    } else {
        showNotification('Please click on a cell to edit first.', 'info');
    }
}

// Show notification
function showNotification(message, type = 'info') {
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.textContent = message;
    
    // Add styles
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 12px 20px;
        border-radius: 6px;
        color: white;
        font-weight: 500;
        z-index: 1000;
        animation: slideIn 0.3s ease-out;
    `;
    
    // Set background color based on type
    switch (type) {
        case 'success':
            notification.style.backgroundColor = '#27ae60';
            break;
        case 'error':
            notification.style.backgroundColor = '#e74c3c';
            break;
        case 'warning':
            notification.style.backgroundColor = '#f39c12';
            break;
        default:
            notification.style.backgroundColor = '#3498db';
    }
    
    // Add to page
    document.body.appendChild(notification);
    
    // Remove after 3 seconds
    setTimeout(() => {
        notification.remove();
    }, 3000);
}

// Setup event listeners
function setupEventListeners() {
    // Edit mode toggle
    document.getElementById('editModeBtn').addEventListener('click', toggleEditMode);
    
    // Save all changes
    document.getElementById('saveAllBtn').addEventListener('click', saveAllChanges);
    
    // Reset week
    document.getElementById('resetWeekBtn').addEventListener('click', resetWeek);
    
    // Print schedule
    document.getElementById('printBtn').addEventListener('click', printSchedule);
    
    // Bulk actions
    document.getElementById('applyBulkBtn').addEventListener('click', applyBulkActivity);
    document.getElementById('clearDayBtn').addEventListener('click', clearSelectedDay);
    
    // Template buttons
    document.querySelectorAll('.template-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const activity = btn.dataset.activity;
            applyTemplate(activity);
        });
    });
}

// Initialize when DOM is loaded
document.addEventListener('DOMContentLoaded', initWeeklySchedule);
</script>
{% endblock %}
